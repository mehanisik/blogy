---
import { getCollection } from "astro:content";
import RichTextEditor from "../../components/admin/rich-text-editor";
import Layout from "../../layouts/layout.astro";

export async function getStaticPaths() {
  const posts = await getCollection("writings");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

interface Props {
  
  post: any;
}

const { post } = Astro.props;
const { data } = post;
---

<Layout
    title={`${data.title} | Mehanisik`}
    description={data.description || ""}
    image={data.cover_image || "/og-image.jpg"}
    type="article"
    publishDate={data.date}
>
    <script
        is:inline
        type="application/ld+json"
        slot="head"
        set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "BlogPosting",
            headline: data.title,
            image: data.cover_image
                ? [new URL(data.cover_image, Astro.site)]
                : [],
            datePublished: new Date(data.date).toISOString(),
            author: [
                {
                    "@type": "Person",
                    name: "Mehanisik",
                    url: "https://mehanisik.is-a.dev",
                },
            ],
        })}
    />

    <main class="min-h-screen pt-24 pb-24 px-6">
        <article class="mx-auto max-w-3xl fade-in">
            <header class="mb-12 flex flex-col items-center text-center">
                <div class="w-full flex justify-start mb-8">
                    <a
                        href="/#writings"
                        class="inline-flex items-center gap-2 text-sm font-mono text-[var(--text-tertiary)] hover:text-[var(--accent-color)] transition-colors no-underline"
                    >
                        ← Back
                    </a>
                </div>

                <div
                    class="flex items-center gap-4 text-xs font-mono text-[var(--accent-color)] uppercase tracking-wider mb-6"
                >
                    <time datetime={data.date}>
                        {
                            new Date(data.date).toLocaleDateString("en-US", {
                                month: "long",
                                day: "numeric",
                                year: "numeric",
                            })
                        }
                    </time>
                    {
                        data.metadata && (data.metadata as any).read_time && (
                            <>
                                <span>•</span>
                                <span>
                                    {(data.metadata as any).read_time} min read
                                </span>
                            </>
                        )
                    }
                </div>

                <h1
                    class="text-4xl md:text-6xl font-bold mb-8 leading-tight text-[var(--text-primary)] max-w-4xl"
                >
                    {data.title}
                </h1>

                {
                    data.description && (
                        <p class="text-xl text-[var(--text-secondary)] leading-relaxed max-w-2xl mb-12">
                            {data.description}
                        </p>
                    )
                }

                {
                    data.cover_image && data.type !== "paper" && (
                        <div class="w-full rounded-lg overflow-hidden border border-[var(--border-color)]">
                            <img
                                src={data.cover_image}
                                alt={data.title}
                                class="w-full h-auto object-cover"
                            />
                        </div>
                    )
                }
            </header>

            <div class="max-w-none">
                {
                    data.type === "paper" ? (
                        <div class="w-full h-[800px] border border-[var(--border-color)] rounded-lg overflow-hidden">
                            <iframe
                                src={data.url || (data.metadata as any)?.pdf}
                                class="w-full h-full"
                                title={data.title}
                            />
                        </div>
                    ) : (
                        <RichTextEditor
                            client:only="react"
                            content={data.content || ""}
                            editable={false}
                        />
                    )
                }
            </div>
        </article>
    </main>
</Layout>

<style is:global>
    body {
        background-color: #171717;
    }

    .prose {
        --tw-prose-body: #d4d4d4;
        --tw-prose-headings: var(--text-primary);
        --tw-prose-lead: #d4d4d4;
        --tw-prose-links: var(--accent-color);
        --tw-prose-bold: var(--text-primary);
        --tw-prose-counters: var(--text-tertiary);
        --tw-prose-bullets: var(--text-tertiary);
        --tw-prose-hr: var(--border-color);
        --tw-prose-quotes: #d4d4d4;
        --tw-prose-quote-borders: var(--accent-color);
        --tw-prose-captions: var(--text-tertiary);
        --tw-prose-code: var(--accent-color);
        --tw-prose-pre-code: #d4d4d4;
        --tw-prose-pre-bg: var(--bg-secondary);
        --tw-prose-th-borders: var(--border-color);
        --tw-prose-td-borders: var(--border-color);
    }

    .prose h1,
    .prose h2,
    .prose h3,
    .prose h4 {
        font-weight: 600;
        letter-spacing: -0.02em;
        margin-top: 2em;
        margin-bottom: 0.75em;
    }

    .prose p {
        margin-bottom: 1.5em;
        line-height: 1.75;
    }

    .prose a {
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color 0.2s;
    }

    .prose a:hover {
        border-bottom-color: var(--accent-color);
    }

    .prose code {
        font-family: "Geist Mono", monospace;
        font-size: 0.9em;
        padding: 0.2em 0.4em;
        border-radius: 0.25em;
        background-color: var(--bg-secondary);
    }

    .prose pre {
        background-color: var(--bg-secondary) !important;
        border: 1px solid var(--border-color);
        border-radius: 0.5rem;
        padding: 1.5em;
        overflow-x: auto;
    }

    .prose pre code {
        background-color: transparent;
        padding: 0;
        color: inherit;
        font-size: 0.875em;
        font-family: "Geist Mono", monospace;
    }

    .prose blockquote {
        border-left-width: 2px;
        padding-left: 1.5em;
        font-style: italic;
    }

    .prose ul,
    .prose ol {
        padding-left: 1.5em;
    }

    .prose li {
        margin-bottom: 0.5em;
    }

    .prose img {
        border-radius: 0.5rem;
        border: 1px solid var(--border-color);
    }
</style>
