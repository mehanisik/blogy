---
import type { Writing, WritingMetadata } from "../lib/api";

interface Props {
  writings: Writing[];
}

const { writings } = Astro.props;

const getLink = (item: Writing) => {
  if (item.type === "blog") return `/blog/${item.slug}`;
  const meta = item.metadata as unknown as WritingMetadata;
  return item.url || meta?.doi || "#";
};
---

<section id="writings" class="w-full">
	<div class="flex flex-col">
		{
			writings.length > 0 ? (
				writings.map((item) => (
					<a
						href={getLink(item)}
						target={item.type !== "blog" ? "_blank" : undefined}
						rel={
							item.type !== "blog"
								? "noopener noreferrer"
								: undefined
						}
						class="group block border-t border-[var(--border-color)] py-8 hover:bg-[var(--bg-secondary)] transition-colors -mx-6 px-6"
					>
						<div class="grid grid-cols-1 md:grid-cols-12 gap-4 items-center">
							<div class="md:col-span-2">
								<span class="text-xs font-mono text-[var(--text-tertiary)] uppercase tracking-wider">
									{new Date(item.date).toLocaleDateString(
										"en-US",
										{
											month: "short",
											year: "numeric",
										},
									)}
								</span>
							</div>

							<div class="md:col-span-8">
								<h3 class="text-xl font-medium group-hover:text-[var(--accent-color)] transition-colors">
									{item.title}
								</h3>
								{item.type === "blog" && item.description && (
									<p class="text-sm text-[var(--text-secondary)] mt-2 line-clamp-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
										{item.description}
									</p>
								)}
							</div>

							<div class="md:col-span-2 flex justify-end items-center gap-4">
								<span class="text-[10px] font-mono uppercase tracking-wider text-[var(--text-tertiary)] border border-[var(--border-color)] px-2 py-1 rounded-full">
									{item.type === "blog" ? "Article" : "Paper"}
								</span>
								<svg
									class="w-5 h-5 transform -rotate-45 group-hover:rotate-0 transition-transform duration-300 text-[var(--accent-color)] opacity-0 group-hover:opacity-100"
									fill="none"
									stroke="currentColor"
									stroke-width="2"
									viewBox="0 0 24 24"
								>
									<path d="M5 12h14M12 5l7 7-7 7" />
								</svg>
							</div>
						</div>
					</a>
				))
			) : (
				<p class="text-sm text-[var(--text-secondary)] italic py-8 border-t border-[var(--border-color)]">
					No writings found.
				</p>
			)
		}
		<div class="border-t border-[var(--border-color)]"></div>
	</div>
</section>
